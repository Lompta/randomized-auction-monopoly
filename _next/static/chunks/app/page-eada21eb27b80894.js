(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{8950:function(e,t,s){Promise.resolve().then(s.bind(s,517))},517:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return W}});var r=s(7437),n=s(2265),a=s(1994),o=s(3335);function i(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,o.m6)((0,a.W)(t))}let l=e=>e.replace(/[<>]/g,"").replace(/[^a-zA-Z0-9\s_-]/g,"").trim().slice(0,20),u=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:i("rounded-lg border bg-card text-card-foreground shadow-sm",s),...n})});u.displayName="Card";let c=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:i("flex flex-col space-y-1.5 p-6",s),...n})});c.displayName="CardHeader";let d=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("h3",{ref:t,className:i("text-2xl font-semibold leading-none tracking-tight",s),...n})});d.displayName="CardTitle";let p=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,r.jsx)("div",{ref:t,className:i("p-6 pt-0",s),...n})});p.displayName="CardContent";var h=s(1717);function m(e){let{checked:t,onCheckedChange:s,disabled:n=!1}=e;return(0,r.jsx)("button",{type:"button",role:"switch","aria-checked":t,onClick:()=>!n&&s(!t),className:"\n        relative inline-flex h-6 w-11 items-center rounded-full \n        ".concat(n?"opacity-50 cursor-not-allowed":"cursor-pointer","\n        ").concat(t?"bg-blue-600":"bg-gray-200","\n      "),disabled:n,children:(0,r.jsx)("span",{className:"\n          inline-block h-4 w-4 transform rounded-full bg-white transition\n          ".concat(t?"translate-x-6":"translate-x-1","\n        ")})})}var g=e=>{let{settings:t,onSettingsChange:s,disabled:n=!1}=e;return(0,r.jsxs)(u,{className:"w-full",children:[(0,r.jsx)(c,{children:(0,r.jsx)(d,{children:"Game Settings"})}),(0,r.jsx)(p,{className:"space-y-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"space-y-0.5",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Simultaneous Bidding"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"All players bid at once instead of taking turns"})]}),(0,r.jsx)(m,{checked:t.simultaneousMode,onCheckedChange:e=>s({...t,simultaneousMode:e}),disabled:n})]})})]})};let y={simultaneousMode:!1},b={stage:"auction",settings:y,players:{},currentProperty:null,properties:[],currentBids:{},biddingComplete:{},consecutivePasses:0,currentPlayerIndex:0,simulationResults:null,unownedProperties:[],auctionHistory:[]};var x=e=>{let{onGameReady:t}=e,[s,a]=(0,n.useState)(""),[o,i]=(0,n.useState)(""),[m,b]=(0,n.useState)(null),[x,f]=(0,n.useState)(""),[j,v]=(0,n.useState)(y),{isHost:N,connectedPlayers:w,setPlayerName:P,hostGame:R,joinGame:C,peerManager:A}=(0,h.r)(),E=N||w.length>0,T=async()=>{if(!s.trim()){b("Please enter your name");return}f("Setting up host connection..."),b(null);try{a(l(s)),P(s);let e=await R();i(e),f("Connected! Waiting for players..."),null==A||A.broadcast({type:"PLAYER_JOIN",name:s})}catch(e){b(e instanceof Error?e.message:"Failed to host game"),f("")}},M=async()=>{if(!s.trim()){b("Please enter your name");return}if(!o.trim()){b("Please enter a room code");return}f("Connecting to game..."),b(null);try{a(l(s)),P(s),await C(o),f("Connected!"),null==A||A.broadcast({type:"PLAYER_JOIN",name:s})}catch(e){b(e instanceof Error?e.message:"Failed to join game"),f("")}};return(0,n.useEffect)(()=>{if(A)return A.onMessage(e=>{"GAME_START"===e.type&&e.settings&&t(N,e.settings)})},[A,N,t]),(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,r.jsxs)(u,{className:"w-full max-w-md",children:[(0,r.jsx)(c,{children:(0,r.jsx)(d,{children:E?N?"Waiting for Players":"Joining Game":"Monopoly Auction"})}),(0,r.jsxs)(p,{className:"space-y-4",children:[m&&(0,r.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:(0,r.jsx)("span",{className:"block sm:inline",children:m})}),x&&(0,r.jsx)("div",{className:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative",children:(0,r.jsx)("span",{className:"block sm:inline",children:x})}),!E&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium",children:"Your Name"}),(0,r.jsx)("input",{type:"text",value:s,onChange:e=>a(e.target.value),className:"w-full p-2 border rounded",placeholder:"Enter your name"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("button",{onClick:T,className:"w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:opacity-50",disabled:!s.trim()||!!x,children:"Host New Game"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,r.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,r.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,r.jsx)("span",{className:"px-2 bg-white text-gray-500",children:"Or"})})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("input",{type:"text",value:o,onChange:e=>i(e.target.value),className:"w-full p-2 border rounded",placeholder:"Enter room code",disabled:!!x}),(0,r.jsx)("button",{onClick:M,className:"w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 disabled:opacity-50",disabled:!s.trim()||!o.trim()||!!x,children:"Join Game"})]})]})]}),E&&(0,r.jsxs)(r.Fragment,{children:[N&&o&&(0,r.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative",children:[(0,r.jsx)("p",{className:"font-bold",children:"Share this room code with other players:"}),(0,r.jsx)("p",{className:"text-2xl text-center mt-2",children:o})]}),N&&(0,r.jsx)(g,{settings:j,onSettingsChange:v,disabled:0===w.length}),(0,r.jsxs)("div",{className:"bg-purple-100 border border-purple-400 text-purple-700 px-4 py-3 rounded relative",children:[(0,r.jsx)("div",{className:"font-bold mb-1",children:"Connected Players:"}),w.length>0?(0,r.jsx)("ul",{className:"list-disc list-inside",children:w.map((e,t)=>(0,r.jsx)("li",{children:e},t))}):(0,r.jsx)("p",{className:"italic",children:"Waiting for players to join..."})]}),N&&w.length>=2&&(0,r.jsxs)("button",{onClick:()=>{if(w.length<2){b("Need at least 2 players to start");return}null==A||A.broadcast({type:"GAME_START",settings:j}),t(N,j)},className:"w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600",children:["Start Game with ",w.length," Players"]})]})]})]})})};function f(e){let{children:t,onClose:s}=e;return(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:s}),(0,r.jsx)("div",{className:"relative bg-white p-6 rounded-lg shadow-lg",children:(0,r.jsx)("button",{onClick:s,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:t})})]})}function j(e){return(0,r.jsx)("button",{...e})}let v=[{name:"Mediterranean Avenue",group:"brown",price:60,baseRent:2,houseRent:[10,30,90,160],hotelRent:250,houseCost:50},{name:"Baltic Avenue",group:"brown",price:60,baseRent:4,houseRent:[20,60,180,320],hotelRent:450,houseCost:50},{name:"Oriental Avenue",group:"lightBlue",price:100,baseRent:6,houseRent:[30,90,270,400],hotelRent:550,houseCost:50},{name:"Vermont Avenue",group:"lightBlue",price:100,baseRent:6,houseRent:[30,90,270,400],hotelRent:550,houseCost:50},{name:"Connecticut Avenue",group:"lightBlue",price:120,baseRent:8,houseRent:[40,100,300,450],hotelRent:600,houseCost:50},{name:"St. Charles Place",group:"pink",price:140,baseRent:10,houseRent:[50,150,450,625],hotelRent:750,houseCost:100},{name:"States Avenue",group:"pink",price:140,baseRent:10,houseRent:[50,150,450,625],hotelRent:750,houseCost:100},{name:"Virginia Avenue",group:"pink",price:160,baseRent:12,houseRent:[60,180,500,700],hotelRent:900,houseCost:100},{name:"St. James Place",group:"orange",price:180,baseRent:14,houseRent:[70,200,550,700],hotelRent:950,houseCost:100},{name:"Tennessee Avenue",group:"orange",price:180,baseRent:14,houseRent:[70,200,550,700],hotelRent:950,houseCost:100},{name:"New York Avenue",group:"orange",price:200,baseRent:16,houseRent:[80,220,600,800],hotelRent:1e3,houseCost:100},{name:"Kentucky Avenue",group:"red",price:220,baseRent:18,houseRent:[90,250,700,875],hotelRent:1050,houseCost:150},{name:"Indiana Avenue",group:"red",price:220,baseRent:18,houseRent:[90,250,700,875],hotelRent:1050,houseCost:150},{name:"Illinois Avenue",group:"red",price:240,baseRent:20,houseRent:[100,300,750,925],hotelRent:1100,houseCost:150},{name:"Atlantic Avenue",group:"yellow",price:260,baseRent:22,houseRent:[110,330,800,975],hotelRent:1150,houseCost:150},{name:"Ventnor Avenue",group:"yellow",price:260,baseRent:22,houseRent:[110,330,800,975],hotelRent:1150,houseCost:150},{name:"Marvin Gardens",group:"yellow",price:280,baseRent:24,houseRent:[120,360,850,1025],hotelRent:1200,houseCost:150},{name:"Pacific Avenue",group:"green",price:300,baseRent:26,houseRent:[130,390,900,1100],hotelRent:1275,houseCost:200},{name:"North Carolina Avenue",group:"green",price:300,baseRent:26,houseRent:[130,390,900,1100],hotelRent:1275,houseCost:200},{name:"Pennsylvania Avenue",group:"green",price:320,baseRent:28,houseRent:[150,450,1e3,1200],hotelRent:1400,houseCost:200},{name:"Park Place",group:"darkBlue",price:350,baseRent:35,houseRent:[175,500,1100,1300],hotelRent:1500,houseCost:200},{name:"Boardwalk",group:"darkBlue",price:400,baseRent:50,houseRent:[200,600,1400,1700],hotelRent:2e3,houseCost:200},{name:"Reading Railroad",group:"railroad",price:200,baseRent:25,houseRent:[],hotelRent:0,houseCost:0},{name:"Pennsylvania Railroad",group:"railroad",price:200,baseRent:25,houseRent:[],hotelRent:0,houseCost:0},{name:"B. & O. Railroad",group:"railroad",price:200,baseRent:25,houseRent:[],hotelRent:0,houseCost:0},{name:"Short Line",group:"railroad",price:200,baseRent:25,houseRent:[],hotelRent:0,houseCost:0},{name:"Electric Company",group:"utility",price:150,baseRent:0,houseRent:[],hotelRent:0,houseCost:0},{name:"Water Works",group:"utility",price:150,baseRent:0,houseRent:[],hotelRent:0,houseCost:0}],N=["Go","Mediterranean Avenue","Community Chest","Baltic Avenue","Income Tax","Reading Railroad","Oriental Avenue","Chance","Vermont Avenue","Connecticut Avenue","Jail","St. Charles Place","Electric Company","States Avenue","Virginia Avenue","Pennsylvania Railroad","St. James Place","Community Chest","Tennessee Avenue","New York Avenue","Free Parking","Kentucky Avenue","Chance","Indiana Avenue","Illinois Avenue","B. & O. Railroad","Atlantic Avenue","Ventnor Avenue","Water Works","Marvin Gardens","Go To Jail","Pacific Avenue","North Carolina Avenue","Community Chest","Pennsylvania Avenue","Short Line","Chance","Park Place","Luxury Tax","Boardwalk"],w=e=>v.find(t=>t.name===e)||null,P={GO_SALARY:200,LUXURY_TAX:75,INCOME_TAX:200,INCOME_TAX_PERCENTAGE:.1,JAIL_FINE:50,MAX_HOUSES:32,MAX_HOTELS:12,MAX_TURNS:1e3,MORTGAGE_RATE:.5,UNMORTGAGE_FEE:.1},R={brown:2,lightBlue:3,pink:3,orange:3,red:3,yellow:3,green:3,darkBlue:2,railroad:4,utility:2},C=["darkBlue","green","yellow","red","orange","pink","lightBlue","brown"];class A{static buildHouses(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=0,n=0;for(let a of C){let o=e.propertyGroups[a];if(!(null==o?void 0:o.monopoly))continue;let i=v.filter(e=>e.group===a);for(;t>0;){let a=3,l=null;for(let e of i){let t=o.houses[e.name]||0;t<a&&t<3&&(a=t,l=e)}if(!l||e.money-r<l.houseCost+s)break;o.houses[l.name]=(o.houses[l.name]||0)+1,r+=l.houseCost,n++,t--}}for(let a of C){let o=e.propertyGroups[a];if(!(null==o?void 0:o.monopoly))continue;let i=v.filter(e=>e.group===a);if(i.every(e=>(o.houses[e.name]||0)>=3))for(;t>0;){let a=null;for(let e of i)if(4>(o.houses[e.name]||0)){a=e;break}if(!a||e.money-r<a.houseCost+s)break;o.houses[a.name]=(o.houses[a.name]||0)+1,r+=a.houseCost,n++,t--}}return{spent:r,housesBuilt:n}}static raiseMoney(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,r=0;for(let n of this.getNonMonopolyProperties(e).filter(e=>"railroad"!==e.group).sort((e,t)=>t.price-e.price)){if(r>=t)break;this.isPropertyMortgaged(e,n.name)||(r+=n.price*s,this.mortgageProperty(e,n.name))}for(let n of this.getNonMonopolyProperties(e).filter(e=>"railroad"===e.group)){if(r>=t)break;this.isPropertyMortgaged(e,n.name)||(r+=n.price*s,this.mortgageProperty(e,n.name))}if(r<t){let s=this.sellHousesForMoney(e,t-r);r+=s}return r}static getNonMonopolyProperties(e){let t=[];for(let[s,r]of Object.entries(e.propertyGroups))if(!r.monopoly)for(let e of r.owned){let s=w(e);s&&t.push(s)}return t}static isPropertyMortgaged(e,t){var s;let r=w(t);if(!r)return!1;let n=e.propertyGroups[r.group];return(null==n?void 0:null===(s=n.mortgaged)||void 0===s?void 0:s[t])||!1}static mortgageProperty(e,t){let s=w(t);if(!s)return;let r=e.propertyGroups[s.group];r&&(r.mortgaged||(r.mortgaged={}),r.mortgaged[t]=!0)}static sellHousesForMoney(e,t){let s=0;for(let r of[...C].reverse()){let n=e.propertyGroups[r];if(!(null==n?void 0:n.monopoly))continue;let a=v.filter(e=>e.group===r);for(;s<t;){let e=0,t=null;for(let s of a){let r=n.houses[s.name]||0;r>e&&(e=r,t=s)}if(!t||0===e)break;n.houses[t.name]--,s+=t.houseCost/2}if(s<t&&a.every(e=>0===(n.houses[e.name]||0)))for(let t of a)this.isPropertyMortgaged(e,t.name)||(this.mortgageProperty(e,t.name),s+=.5*t.price);if(s>=t)break}return s}}class E{initializeGame(e){let t={};for(let[s,r]of Object.entries(e))t[s]={money:r.money,position:0,jailTurns:0,propertyGroups:{},getOutOfJailCards:0};return{players:t,availableHouses:P.MAX_HOUSES,availableHotels:P.MAX_HOTELS,freeParkingMoney:0,currentTurn:1,currentPlayer:Object.keys(t)[0],winner:null,bankruptPlayers:[]}}assignInitialProperties(e){let t=new Set;for(let[s,r]of Object.entries(e))for(let e of r){if(t.has(e))throw Error("Property ".concat(e," assigned multiple times"));if(!w(e))throw Error("Invalid property name: ".concat(e));t.add(e)}for(let[t,s]of Object.entries(e)){let e=this.state.players[t];if(!e)continue;let r={};for(let e of s){let t=w(e);r[t.group]||(r[t.group]=[]),r[t.group].push(e)}for(let[t,s]of Object.entries(r))e.propertyGroups[t]={owned:s,monopoly:s.length===R[t],houses:Object.fromEntries(s.map(e=>[e,0])),hotels:Object.fromEntries(s.map(e=>[e,0])),mortgaged:Object.fromEntries(s.map(e=>[e,!1]))}}}rollDice(){return[Math.floor(6*Math.random())+1,Math.floor(6*Math.random())+1]}log(e,t){this.debug&&(this.logs.push({turn:this.state.currentTurn,player:e,action:t,resultingState:structuredClone(this.state)}),"PAY_RENT"===t.type&&console.log({turn:this.state.currentTurn,player:e,action:t}))}calculateRent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=this.findPropertyOwner(e.name);if(!s)return 0;let r=s.propertyGroups[e.group];if(!r||r.mortgaged[e.name])return 0;if("utility"===e.group)return t*(r.monopoly?10:4);if("railroad"===e.group){let t=r.owned.length;return e.baseRent*Math.pow(2,t-1)}let n={houses:r.houses[e.name]||0,hotels:r.hotels[e.name]||0};return n.hotels>0?e.hotelRent:n.houses>0?e.houseRent[n.houses-1]:e.baseRent*(r.monopoly?2:1)}findPropertyOwner(e){for(let[t,s]of Object.entries(this.state.players))for(let t of Object.values(s.propertyGroups))if(t.owned.includes(e))return s;return null}attemptPayment(e,t,s){let r=this.state.players[e];if(!r)return!1;if(r.money>=s)return r.money-=s,t&&this.state.players[t]?this.state.players[t].money+=s:t||(this.state.freeParkingMoney+=s),!0;let n=s-r.money,a=A.raiseMoney(r,n,.5);return r.money+a<s?(this.handleBankruptcy(e,t),!1):(r.money=r.money+a-s,t&&this.state.players[t]?this.state.players[t].money+=s:t||(this.state.freeParkingMoney+=s),!0)}handleBankruptcy(e,t){let s=this.state.players[e];if(t&&this.state.players[t]){let e=this.state.players[t];for(let[t,r]of Object.entries(s.propertyGroups))e.propertyGroups[t]||(e.propertyGroups[t]={owned:[],monopoly:!1,houses:{},hotels:{},mortgaged:{}}),e.propertyGroups[t].owned.push(...r.owned),Object.assign(e.propertyGroups[t].houses,r.houses),Object.assign(e.propertyGroups[t].hotels,r.hotels),Object.assign(e.propertyGroups[t].mortgaged,r.mortgaged);s.money>0&&(e.money+=s.money)}s.money=0,s.propertyGroups={},this.state.bankruptPlayers.push(e);let r=Object.keys(this.state.players).filter(e=>!this.state.bankruptPlayers.includes(e));1===r.length&&(this.state.winner=r[0])}simulateTurn(){let e=this.state.currentPlayer;if(this.state.winner||!e)return!1;let t=this.state.players[e];if(!t||this.state.bankruptPlayers.includes(e))return this.nextPlayer(),!0;this.state.bankruptPlayers.includes(e)||A.buildHouses(t,this.state.availableHouses,0);let[s,r]=this.rollDice(),n=s+r;if(this.log(e,{type:"ROLL_DICE"}),t.jailTurns>0){if(s!==r&&3!==t.jailTurns&&!(t.getOutOfJailCards>0))return t.jailTurns++,this.nextPlayer(),!0;t.getOutOfJailCards>0?t.getOutOfJailCards--:3===t.jailTurns&&this.attemptPayment(e,null,P.JAIL_FINE),t.jailTurns=0}t.position=(t.position+n)%N.length,t.position<n&&(t.money+=P.GO_SALARY,this.log(e,{type:"COLLECT_GO"}));let a=N[t.position],o=w(a);if(o){let s=this.findPropertyOwner(o.name);if(s&&s!==t){let t=this.calculateRent(o,n);this.attemptPayment(e,s.money.toString(),t),this.log(e,{type:"PAY_RENT",amount:t,to:s.position.toString()})}}else switch(a){case"Income Tax":let i=Math.min(P.INCOME_TAX,Math.floor(t.money*P.INCOME_TAX_PERCENTAGE));this.attemptPayment(e,null,i),this.log(e,{type:"PAY_TAX",amount:i});break;case"Luxury Tax":this.attemptPayment(e,null,P.LUXURY_TAX),this.log(e,{type:"PAY_TAX",amount:P.LUXURY_TAX});break;case"Go To Jail":t.position=N.indexOf("Jail"),t.jailTurns=1,this.log(e,{type:"GO_TO_JAIL"})}return!(s!==r||this.state.bankruptPlayers.includes(e))||(this.nextPlayer(),!0)}nextPlayer(){let e=Object.keys(this.state.players),t=e.indexOf(this.state.currentPlayer),s=(t+1)%e.length;for(;this.state.bankruptPlayers.includes(e[s]);)if((s=(s+1)%e.length)===t){this.state.winner="draw";return}this.state.currentPlayer=e[s];let r=Object.keys(this.state.players).find(e=>!this.state.bankruptPlayers.includes(e));r&&s===Object.keys(this.state.players).indexOf(r)&&this.state.currentTurn++}getState(){return structuredClone(this.state)}getLogs(){return this.debug?structuredClone(this.logs):[]}simulateToEnd(){for(;!this.state.winner&&this.state.currentTurn<P.MAX_TURNS;)this.simulateTurn();return this.getState()}getMortgageValue(e){return Math.floor(e.price*P.MORTGAGE_RATE)}getUnmortgageCost(e){let t=this.getMortgageValue(e),s=Math.ceil(t*P.UNMORTGAGE_FEE);return t+s}validateHouseCount(e){if(!e.monopoly)return!0;let t=Object.values(e.houses);return Math.max(...t)-Math.min(...t)<=1}mortgageProperty(e,t){let s=w(t);if(!s)return 0;let r=e.propertyGroups[s.group];if(!r||r.mortgaged[t]||Object.values(r.houses).some(e=>e>0))return 0;let n=this.getMortgageValue(s);return r.mortgaged[t]=!0,e.money+=n,this.log(this.state.currentPlayer,{type:"MORTGAGE_PROPERTY",property:t}),n}unmortgageProperty(e,t){let s=w(t);if(!s)return!1;let r=e.propertyGroups[s.group];if(!r||!r.mortgaged[t])return!1;let n=this.getUnmortgageCost(s);return!(e.money<n)&&(r.mortgaged[t]=!1,e.money-=n,this.log(this.state.currentPlayer,{type:"UNMORTGAGE_PROPERTY",property:t}),!0)}sellHouse(e,t){return 0===(e.houses[t.name]||0)?0:(e.houses[t.name]--,this.validateHouseCount(e))?(this.state.availableHouses++,Math.floor(t.houseCost/2)):(e.houses[t.name]++,0)}constructor(e,t=!1){this.logs=[],this.debug=t,this.state=this.initializeGame(e),this.assignInitialProperties(Object.fromEntries(Object.entries(e).map(e=>{let[t,s]=e;return[t,s.properties]})))}}class T{runSimulation(){let e={totalGames:this.numGames,wins:Object.fromEntries(Object.keys(this.playerConditions).map(e=>[e,0])),draws:0,averageGameLength:0,bankruptcyRates:Object.fromEntries(Object.keys(this.playerConditions).map(e=>[e,0]))},t=0;for(let s=0;s<this.numGames;s++){let s=new E(this.playerConditions,this.debug).simulateToEnd();for(let r of(t+=s.currentTurn,"draw"===s.winner?e.draws++:s.winner&&e.wins[s.winner]++,s.bankruptPlayers))e.bankruptcyRates[r]++}for(let s in e.averageGameLength=t/this.numGames,e.bankruptcyRates)e.bankruptcyRates[s]=e.bankruptcyRates[s]/this.numGames;return e}constructor(e,t=100,s=!1){this.playerConditions=e,this.numGames=t,this.debug=s}}let M=e=>Object.entries(e).reduce((e,t)=>{let[s,r]=t;return{...e,[s]:{money:r.money,properties:r.properties.map(e=>e.name)}}},{}),O=e=>({games_played:e.totalGames,clear_wins:Object.values(e.wins).reduce((e,t)=>e+t,0),draws:e.draws,draw_percentage:"".concat((e.draws/e.totalGames*100).toFixed(1),"%"),survival_rates:Object.entries(e.wins).reduce((t,s)=>{let[r,n]=s;return{...t,[r]:"".concat((n/e.totalGames*100).toFixed(1),"%")}},{}),bankruptcies:Object.entries(e.bankruptcyRates).reduce((t,s)=>{let[r,n]=s;return{...t,[r]:Math.round(n*e.totalGames)}},{}),average_rounds:Math.round(e.averageGameLength)}),k=async e=>new Promise(t=>{t(O(new T(M(e),100,!1).runSimulation()))});function G(e,t){var s,r;return null!==(r=null===(s=e.players[t])||void 0===s?void 0:s.money)&&void 0!==r?r:0}let S={brown:"bg-yellow-900",lightBlue:"bg-sky-300",pink:"bg-pink-400",orange:"bg-orange-500",red:"bg-red-600",yellow:"bg-yellow-400",green:"bg-green-600",darkBlue:"bg-blue-800",railroad:"bg-gray-700",utility:"bg-gray-500",default:"bg-gray-200"},_=e=>{let t=["brown","lightBlue","pink","orange","red","yellow","green","darkBlue","railroad","utility"];return[...e].sort((e,s)=>{let r=t.indexOf(e.group)-t.indexOf(s.group);return 0!==r?r:e.price-s.price})};var B=e=>{let{properties:t,isHighlighted:s=!1,showTooltips:n=!1}=e;if(!t||0===t.length)return null;let a=_(t).reduce((e,t)=>(e[t.group]||(e[t.group]=[]),e[t.group].push(t),e),{});return(0,r.jsx)("div",{className:"p-2 rounded ".concat(s?"bg-blue-50 border border-blue-200":""),children:(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:Object.entries(a).map(e=>{let[t,s]=e;return(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:s.map(e=>(0,r.jsxs)("div",{className:"".concat(S[e.group]," text-xs p-1 rounded shadow-sm relative group cursor-pointer"),style:{minWidth:"60px",maxWidth:"100px"},children:[(0,r.jsx)("div",{className:"text-white text-center whitespace-nowrap overflow-hidden text-ellipsis",children:e.name}),n&&(0,r.jsxs)("div",{className:"absolute z-10 invisible group-hover:visible bg-white text-black p-2 rounded shadow-lg -top-2 left-full ml-2 text-xs whitespace-nowrap",children:[(0,r.jsx)("div",{className:"font-bold",children:e.name}),(0,r.jsxs)("div",{children:["Price: $",e.price]}),(0,r.jsxs)("div",{children:["Rent: $",e.baseRent]}),"railroad"!==e.group&&"utility"!==e.group&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:["House Cost: $",e.houseCost]}),(0,r.jsxs)("div",{className:"text-xs mt-1",children:["Houses: ",e.houseRent.map((t,s)=>(0,r.jsxs)("span",{children:["$",t,s<e.houseRent.length-1?", ":""]},s))]}),(0,r.jsxs)("div",{children:["Hotel: $",e.hotelRent]})]})]})]},e.name))},t)})})})},H=e=>{let{property:t,className:s=""}=e,n="railroad"!==t.group&&"utility"!==t.group;return(0,r.jsx)(u,{className:"w-full ".concat(s),children:(0,r.jsxs)(p,{className:"p-4 space-y-3",children:[(0,r.jsxs)("div",{className:"".concat(S[t.group]," text-white p-3 rounded-md"),children:[(0,r.jsx)("h3",{className:"text-xl font-bold",children:t.name}),(0,r.jsx)("p",{className:"text-sm opacity-90",children:t.group.charAt(0).toUpperCase()+t.group.slice(1)})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"font-medium",children:"Price:"}),(0,r.jsxs)("span",{children:["$",t.price]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"font-medium",children:"Base Rent:"}),(0,r.jsxs)("span",{children:["$",t.baseRent]})]}),n&&t.houseRent&&(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("div",{className:"font-medium",children:"House Rent:"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:t.houseRent.map((e,t)=>(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsxs)("span",{children:[t+1," House",0!==t?"s":"",":"]}),(0,r.jsxs)("span",{children:["$",e]})]},t))})]}),n&&t.hotelRent&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"font-medium",children:"Hotel Rent:"}),(0,r.jsxs)("span",{children:["$",t.hotelRent]})]}),n&&t.houseCost&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"font-medium",children:"House Cost:"}),(0,r.jsxs)("span",{children:["$",t.houseCost]})]})]})]})})},I=s(7721),L=s(670),Y=s(8055),J=s(8470),F=s(8182),U=e=>{let{results:t,isHost:s,onPlayAgain:n}=e,a=Object.entries(t.survival_rates).sort((e,t)=>{let[,s]=e,[,r]=t,n=parseFloat(s);return parseFloat(r)-n}),o=e=>{switch(e){case 0:return(0,r.jsx)(I.Z,{className:"text-yellow-400 w-8 h-8"});case 1:return(0,r.jsx)(L.Z,{className:"text-gray-400 w-8 h-8"});case 2:return(0,r.jsx)(L.Z,{className:"text-amber-600 w-8 h-8"});default:return(0,r.jsx)(Y.Z,{className:"text-gray-300 w-6 h-6"})}};return(0,r.jsxs)("div",{className:"space-y-6 bg-gradient-to-b from-blue-50 to-white p-6 rounded-lg shadow-lg",children:[(0,r.jsxs)("div",{className:"text-center space-y-2",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-blue-900",children:"Game Results!"}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-2 text-gray-600",children:[(0,r.jsx)(J.Z,{className:"w-5 h-5"}),(0,r.jsxs)("span",{children:["Average game length: ",t.average_rounds," rounds"]})]})]}),(0,r.jsx)("div",{className:"space-y-4",children:a.map((e,s)=>{let[n,a]=e;return(0,r.jsx)("div",{className:"p-4 rounded-lg transition-all duration-300 ".concat(0===s?"bg-yellow-50 shadow-md transform hover:scale-102":"bg-white"),children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[o(s),(0,r.jsxs)("div",{className:"flex-grow",children:[(0,r.jsx)("h3",{className:"text-lg font-bold",children:n}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["Survival Rate: ",a]})]}),(0,r.jsx)("div",{className:"text-right",children:(0,r.jsxs)("div",{className:"text-sm font-medium",children:[t.bankruptcies[n]," bankruptcies"]})})]})},n)})}),(0,r.jsxs)("div",{className:"text-center text-sm text-gray-500",children:["Based on ",t.games_played," simulated games •",t.draws," draws (",t.draw_percentage,")"]}),s&&(0,r.jsx)("div",{className:"text-center pt-4",children:(0,r.jsxs)("button",{onClick:n,className:"inline-flex items-center gap-2 bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-full shadow-md transition-colors",children:[(0,r.jsx)(F.Z,{className:"w-4 h-4"}),"Play Again"]})})]})},X=e=>{let{history:t}=e;return 0===t.length?null:(0,r.jsxs)(u,{children:[(0,r.jsx)(c,{children:(0,r.jsx)(d,{children:"Previous Auctions"})}),(0,r.jsx)(p,{className:"space-y-4 max-h-64 overflow-y-auto",children:t.map((e,t)=>(0,r.jsxs)("div",{className:"p-3 border rounded bg-gray-50",children:[(0,r.jsx)("div",{className:"font-medium",children:e.property.name}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["Won by ",e.winner," for $",e.amount]}),(0,r.jsxs)("div",{className:"mt-2 text-sm",children:[(0,r.jsx)("div",{className:"font-medium",children:"All bids:"}),Object.entries(e.allBids).sort((e,t)=>{let[,s]=e,[,r]=t;return r-s}).map(e=>{let[t,s]=e;return(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:t}),(0,r.jsxs)("span",{children:["$",s]})]},t)})]})]},t))})]})},$=e=>{var t,s;let{isHost:a,initialSettings:o}=e,{peerManager:i,connectedPlayers:l}=(0,h.r)(),[m,g]=(0,n.useState)(""),{gameState:y,setGameState:x,showAlert:N,setShowAlert:w,alertMessage:P,setAlertMessage:R,isSimulating:C,setIsSimulating:A}=function(e,t){let{peerManager:s,connectedPlayers:r}=(0,h.r)(),[a,o]=(0,n.useState)({...b,settings:t}),[i,l]=(0,n.useState)(!1),[u,c]=(0,n.useState)(""),[d,p]=(0,n.useState)(!1),m=e=>{if(!e.players||!e.properties){console.error("Invalid game state update attempted");return}o(e)};return(0,n.useEffect)(()=>{if(e&&r.length>0){let e=Object.fromEntries(r.map(e=>[e,{money:1500,properties:[]}])),n=[...v].sort(()=>Math.random()-.5),a={...b,settings:t,players:e,currentProperty:n[0],properties:n};m(a),null==s||s.broadcast({type:"GAME_STATE",state:a})}},[e,r,s]),{gameState:a,setGameState:m,showAlert:i,setShowAlert:l,alertMessage:u,setAlertMessage:c,isSimulating:d,setIsSimulating:p}}(a,o),{handleBid:E,handlePass:T,finishAuction:M,submitGameToServer:O}=function(e,t,s,r,n,a,o,i){let l=(a,o)=>{if(!e||!t.currentProperty)return;let i=t.players[o];if(i&&!(a>i.money)){if(t.settings.simultaneousMode){let e={...t,currentBids:{...t.currentBids,[o]:a},biddingComplete:{...t.biddingComplete,[o]:!0}},n=Object.keys(t.players).every(t=>e.biddingComplete[t]);if(s(e),null==r||r.broadcast({type:"GAME_STATE",state:e}),n){let t=Math.max(...Object.values(e.currentBids),0),n=Object.entries(e.currentBids).filter(e=>{let[s,r]=e;return r===t}).map(e=>{let[t]=e;return t})[0],a={...e.players},o=[...e.unownedProperties||[]],i={property:e.currentProperty,winner:n||"No Winner",amount:t,allBids:{...e.currentBids}};n&&t>0?a[n]={...a[n],money:a[n].money-t,properties:[...a[n].properties,e.currentProperty]}:o.push(e.currentProperty);let l=e.properties.slice(1);if(0===l.length){let t={...e,stage:"results",players:a,currentBids:{},biddingComplete:{},consecutivePasses:0,currentProperty:null,unownedProperties:o,auctionHistory:[...e.auctionHistory,i]};s(t),null==r||r.broadcast({type:"GAME_STATE",state:t}),c()}else{let t={...e,players:a,properties:l,currentProperty:l[0],currentBids:{},biddingComplete:{},consecutivePasses:0,currentPlayerIndex:0,unownedProperties:o,auctionHistory:[...e.auctionHistory,i]};s(t),null==r||r.broadcast({type:"GAME_STATE",state:t})}}}else{if(a<=Math.max(...Object.values(t.currentBids),0))return;let e={...t,currentBids:{...t.currentBids,[o]:a},consecutivePasses:0,currentPlayerIndex:(t.currentPlayerIndex+1)%n.length};s(e),null==r||r.broadcast({type:"GAME_STATE",state:e})}}},u=()=>{var n;if(!e||!t.currentProperty)return;let a=Math.max(...Object.values(t.currentBids),0),o=null===(n=Object.entries(t.currentBids).find(e=>{let[t,s]=e;return s===a}))||void 0===n?void 0:n[0],i={...t.players},l=[...t.unownedProperties||[]],u={property:t.currentProperty,winner:o||"No Winner",amount:a,allBids:{...t.currentBids}};o&&a>0?i[o]={...i[o],money:i[o].money-a,properties:[...i[o].properties,t.currentProperty]}:l.push(t.currentProperty);let d=t.properties.slice(1);if(0===d.length){let e={...t,stage:"results",players:i,currentBids:{},biddingComplete:{},consecutivePasses:0,currentProperty:null,unownedProperties:l,auctionHistory:[...t.auctionHistory,u]};s(e),null==r||r.broadcast({type:"GAME_STATE",state:e}),c()}else{let e={...t,players:i,properties:d,currentProperty:d[0],currentBids:{},biddingComplete:{},consecutivePasses:0,currentPlayerIndex:0,unownedProperties:l,auctionHistory:[...t.auctionHistory,u]};s(e),null==r||r.broadcast({type:"GAME_STATE",state:e})}},c=async()=>{if(e){a(!0);try{let e=await k(t.players),n={...t,stage:"results",simulationResults:e,currentProperty:null};s(n),null==r||r.broadcast({type:"GAME_STATE",state:n})}catch(e){console.error("Simulation error:",e),o("Failed to simulate game results"),i(!0)}finally{a(!1)}}};return{handleBid:l,handlePass:a=>{if(e&&t.currentProperty){if(t.settings.simultaneousMode){let e={...t,currentBids:{...t.currentBids,[a]:0},biddingComplete:{...t.biddingComplete,[a]:!0}},n=Object.keys(t.players).every(t=>e.biddingComplete[t]);s(e),null==r||r.broadcast({type:"GAME_STATE",state:e}),n&&l(0,a)}else{let e=t.consecutivePasses+1;if(Object.values(t.currentBids).some(e=>e>0)?e>=n.length-1:e>=n.length)u();else{let a={...t,consecutivePasses:e,currentPlayerIndex:(t.currentPlayerIndex+1)%n.length};s(a),null==r||r.broadcast({type:"GAME_STATE",state:a})}}}},finishAuction:u,submitGameToServer:c}}(a,y,x,i,l,A,R,w),S=l[y.currentPlayerIndex],_=(t=y.currentPlayerIndex,s=null==i?void 0:i.myName,l[t]===s),I=Math.max(...Object.values(y.currentBids),0),L=G(y,S),Y=y.biddingComplete[(null==i?void 0:i.myName)||""];(0,n.useEffect)(()=>{if(i)return i.onMessage(e=>{try{"GAME_STATE"===e.type?x(e.state):"BID"===e.type&&a?E(e.amount,e.player):"PASS"===e.type&&a&&T(e.player)}catch(e){console.error("Error processing message:",e),R("An error occurred processing the game state"),w(!0)}})},[i,a,E,T,x,R,w]);let J=()=>{if(!i||!i.myName)return;let e=parseInt(m,10),t=y.settings.simultaneousMode?0:I+1,s=G(y,i.myName);if(isNaN(e)||e<t||e>s){R(y.settings.simultaneousMode?"Invalid bid amount":"Bid must be between $".concat(t," and $").concat(s)),w(!0);return}i.broadcast({type:"BID",amount:e,player:i.myName}),g("")},F=()=>{(null==i?void 0:i.myName)&&i.broadcast({type:"PASS",player:i.myName})};return(0,r.jsxs)("div",{className:"p-4 max-w-6xl mx-auto space-y-4",children:[(0,r.jsxs)("div",{className:"grid gap-4 lg:grid-cols-3",children:[(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsxs)(u,{children:[(0,r.jsx)(c,{children:(0,r.jsx)(d,{children:"Players' Holdings"})}),(0,r.jsxs)(p,{className:"space-y-4",children:[Object.entries(y.players).map(e=>{let[t,s]=e;return(0,r.jsxs)("div",{className:"p-2 rounded ".concat(t===S?"bg-blue-50":""),children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsx)("h4",{className:"font-bold",children:t}),(0,r.jsxs)("span",{children:["Money: $",s.money]})]}),(0,r.jsx)(B,{properties:s.properties,isHighlighted:t===S,showTooltips:!0})]},t)}),y.unownedProperties&&y.unownedProperties.length>0&&(0,r.jsxs)("div",{className:"mt-4 pt-4 border-t",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Unclaimed Properties"}),(0,r.jsx)(B,{properties:y.unownedProperties,showTooltips:!0})]})]})]})}),y.auctionHistory.length>0&&(0,r.jsx)("div",{children:(0,r.jsx)(X,{history:y.auctionHistory})})]}),"results"===y.stage&&y.simulationResults?(0,r.jsx)(U,{results:y.simulationResults,isHost:a,onPlayAgain:()=>{if(a&&i){let e=Object.fromEntries(l.map(e=>[e,{money:1500,properties:[]}])),t=[...v].sort(()=>Math.random()-.5),s={...b,settings:y.settings,players:e,currentProperty:t[0],properties:t};x(s),i.broadcast({type:"GAME_STATE",state:s})}}}):"auction"===y.stage&&y.currentProperty?(0,r.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,r.jsx)(H,{property:y.currentProperty}),(0,r.jsxs)(u,{children:[(0,r.jsx)(c,{children:(0,r.jsx)(d,{children:y.settings.simultaneousMode?"Simultaneous Bidding Round":"Current Auction"})}),(0,r.jsxs)(p,{className:"space-y-4",children:[(0,r.jsx)("div",{className:"flex flex-wrap gap-4",children:y.settings.simultaneousMode?!Y&&(null==i?void 0:i.myName)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{type:"number",className:"border p-2 rounded",placeholder:"Enter bid amount",value:m,min:0,max:G(y,i.myName),onChange:e=>g(e.target.value)}),(0,r.jsx)("button",{onClick:J,disabled:!m,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50",children:"Submit Bid"}),(0,r.jsx)("button",{onClick:F,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded",children:"Pass"})]}):_&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("input",{type:"number",className:"border p-2 rounded",placeholder:"Enter bid amount",value:m,min:I+1,max:L,onChange:e=>g(e.target.value)}),(0,r.jsx)("button",{onClick:J,disabled:!m,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded disabled:opacity-50",children:"Bid"}),(0,r.jsx)("button",{onClick:F,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded",children:"Pass"})]})}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(y.players).map(e=>{let[t,s]=e;return(0,r.jsx)("div",{className:"p-2 border rounded ".concat(y.settings.simultaneousMode?y.biddingComplete[t]?"bg-green-50":"bg-yellow-50":t===S?"border-blue-500 bg-blue-50":""),children:(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:t}),(0,r.jsx)("span",{children:y.settings.simultaneousMode?y.biddingComplete[t]?"Bid Submitted":"Thinking...":"Bid: $".concat(y.currentBids[t]||0)})]})},t)})})]})]})]}):C?(0,r.jsx)(u,{children:(0,r.jsxs)(p,{className:"p-8 text-center",children:[(0,r.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Simulating Games..."}),(0,r.jsx)("p",{children:"Please wait while we simulate multiple games to determine the winner."})]})}):null,N&&(0,r.jsx)(f,{children:(0,r.jsx)(j,{onClick:()=>w(!1),children:P})})]})};function W(){let[e,t]=(0,n.useState)(!1),[s,a]=(0,n.useState)(!1),[o,i]=(0,n.useState)(y);return(0,r.jsx)("main",{className:"min-h-screen",children:e?(0,r.jsx)($,{isHost:s,initialSettings:o}):(0,r.jsx)(x,{onGameReady:(e,s)=>{a(e),i(s),t(!0)}})})}},1717:function(e,t,s){"use strict";s.d(t,{E:function(){return l},r:function(){return u}});var r=s(7437),n=s(2265),a=s(4370);class o{setMyName(e){this.myName=e,this.isHost&&(this.connectedPlayers.add(e),this.broadcastPlayerList())}broadcastPlayerList(){this.isHost&&(console.log("Broadcasting player list:",Array.from(this.connectedPlayers)),this.broadcast({type:"PLAYER_LIST",players:Array.from(this.connectedPlayers)}))}async hostGame(){return new Promise((e,t)=>{if(this.isHost=!0,this.myName&&this.connectedPlayers.add(this.myName),this.peer.id)e(this.peer.id);else{let s=setTimeout(()=>{t(Error("Timeout waiting for peer ID"))},1e4);this.peer.on("open",t=>{clearTimeout(s),e(t)})}})}async joinGame(e){return new Promise((t,s)=>{let r=this.peer.connect(e,{reliable:!0}),n=setTimeout(()=>{r.close(),s(Error("Connection timeout"))},1e4);r.on("open",()=>{clearTimeout(n),this.setupConnection(r),this.myName&&r.send({type:"PLAYER_JOIN",name:this.myName}),t()}),r.on("error",e=>{clearTimeout(n),s(e)})})}setupConnection(e){this.connections.set(e.peer,e),e.on("data",e=>{this.isValidGameMessage(e)&&(console.log("Received message:",e),"PLAYER_JOIN"===e.type?this.isHost&&!this.connectedPlayers.has(e.name)&&(this.connectedPlayers.add(e.name),this.broadcastPlayerList()):"PLAYER_LIST"!==e.type||this.isHost||(this.connectedPlayers=new Set(e.players)),this.messageHandlers.forEach(t=>t(e)))}),e.on("close",()=>{console.log("Connection closed:",e.peer),this.connections.delete(e.peer)})}getConnectedPlayers(){return Array.from(this.connectedPlayers)}onMessage(e){return this.messageHandlers.push(e),()=>{this.messageHandlers=this.messageHandlers.filter(t=>t!==e)}}broadcast(e){console.log("Broadcasting message:",e),this.connections.forEach(t=>{try{t.send(e)}catch(e){console.error("Failed to send message to peer:",e)}}),this.isHost&&this.messageHandlers.forEach(t=>t(e))}close(){this.connections.forEach(e=>e.close()),this.connections.clear(),this.connectedPlayers.clear(),this.messageHandlers=[],this.peer.destroy()}isValidGameMessage(e){if(!e||"object"!=typeof e||!("type"in e))return!1;switch(e.type){case"GAME_START":return!0;case"GAME_STATE":return"state"in e;case"PLAYER_JOIN":return"string"==typeof e.name;case"PLAYER_LIST":return Array.isArray(e.players);case"BID":return"number"==typeof e.amount&&"string"==typeof e.player;case"PASS":return"string"==typeof e.player;case"SIMULATION_RESULTS":return"results"in e;default:return!1}}constructor(){this.connections=new Map,this.isHost=!1,this.messageHandlers=[],this.connectedPlayers=new Set,this.myName="";let e=Math.random().toString(36).substr(2,9);this.peer=new a.ZP(e),this.peer.on("error",e=>{console.error("Peer error:",e)}),this.peer.on("disconnected",()=>{console.log("Peer disconnected. Attempting to reconnect..."),this.peer.reconnect()}),this.peer.on("connection",e=>{console.log("Received connection from peer:",e.peer),this.setupConnection(e)})}}let i=(0,n.createContext)(null);function l(e){let{children:t}=e,s=(0,n.useRef)(null),[a,l]=(0,n.useState)(!1),[u,c]=(0,n.useState)([]),[d,p]=(0,n.useState)(!1);(0,n.useEffect)(()=>{s.current||(console.log("Creating new PeerManager"),s.current=new o);let e=s.current;return()=>{document.body.contains(document.getElementById("__next"))||(console.log("Truly unmounting, closing peer manager"),e.close(),s.current=null)}},[]),(0,n.useEffect)(()=>{let e=s.current;if(!e)return;let t=e.onMessage(e=>{console.log("PeerContext received message:",e),"PLAYER_LIST"===e.type?c(e.players):"PLAYER_JOIN"===e.type?c(t=>t.includes(e.name)?t:[...t,e.name]):"GAME_START"===e.type&&p(!0)});return()=>t()},[]);let h=(0,n.useCallback)(e=>{s.current&&(s.current.setMyName(e),u.includes(e)||c(t=>[...t,e]))},[u]),m=(0,n.useCallback)(async()=>{if(!s.current)throw Error("PeerManager not initialized");let e=await s.current.hostGame();return l(!0),e},[]),g=(0,n.useCallback)(async e=>{if(!s.current)throw Error("PeerManager not initialized");await s.current.joinGame(e),l(!1)},[]);return(0,r.jsx)(i.Provider,{value:{peerManager:s.current,isHost:a,connectedPlayers:u,setPlayerName:h,hostGame:m,joinGame:g,gameStarted:d,setGameStarted:p},children:t})}let u=()=>{let e=(0,n.useContext)(i);if(!e)throw Error("usePeer must be used within a PeerProvider");return e}}},function(e){e.O(0,[370,48,971,117,744],function(){return e(e.s=8950)}),_N_E=e.O()}]);